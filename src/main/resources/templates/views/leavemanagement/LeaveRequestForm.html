<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <title>Leave Request</title>
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 15px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .btn-approve {
            color: white;
            background-color: #5cb85c;
            border-color: #4cae4c;
        }

        .btn-approve:hover {
            background-color: #4cae4c;
            border-color: #398439;
        }

        .btn-deny {
            color: white;
            background-color: #d9534f;
            border-color: #d43f3a;
        }

        .btn-deny:hover {
            background-color: #c9302c;
            border-color: #ac2925;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        h2 {
            margin-top: 0;
        }

        .tooltip-inner {
            background-color: #5cb85c;
            color: white;
        }

        .tooltip-arrow {
            border-top-color: #5cb85c !important;
        }

        .deny-reason-input {
            width: 200px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
<div data-th-insert="views/fragments/navbar :: navbar"></div>

<div class="container mt-5">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4>Leave Request Form</h4>
        </div>
        <div class="card-body">
            <form th:action="@{/submitLeaveRequest}" th:object="${leave}" method="post" id="leaveForm">
                <div class="form-group">
                    <label for="typeOfLeave">Type of Leave:</label>
                    <select class="form-control" id="typeOfLeave" th:field="*{typeOfLeave}" required>
                        <option value="">Select Leave Type</option>
                        <option value="SickLeave">Sick Leave</option>
                        <option value="CasualLeave">Casual Leave</option>
                        <option value="BereavementLeave">Bereavement Leave</option>
                        <option value="MarriageLeave">Marriage Leave</option>
                        <option value="MaternityLeave">Maternity Leave</option>
                        <option value="PaternityLeave">Paternity Leave</option>
                        <option value="AdoptionLeave">Adoption Leave</option>
                        <option value="EmergencyLeave">Emergency Leave</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="days">Number of Days:</label>
                    <select class="form-control" id="days" th:field="*{days}" required>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="24">24</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reason">Reason:</label>
                    <textarea class="form-control" id="reason" th:field="*{reason}" required></textarea>
                </div>
                <div class="form-group single-date">
                    <label for="dateOfLeave">Date of Leave:</label>
                    <input type="date" class="form-control" id="dateOfLeave" th:field="*{dateOfLeave}" required>
                </div>
                <div class="form-group multiple-dates" style="display: none;">
                    <label for="startDate">Start Date:</label>
                    <input type="date" class="form-control" id="startDate" th:field="*{startDate}">
                </div>
                <div class="form-group multiple-dates" style="display: none;">
                    <label for="endDate">End Date:</label>
                    <input type="date" class="form-control" id="endDate" th:field="*{endDate}">
                </div>
                <input type="hidden" th:field="*{appliedDate}" th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
            <div th:if="${success}" class="alert alert-success mt-3" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger mt-3" th:text="${error}"></div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const typeOfLeaveSelect = document.getElementById('typeOfLeave');
        const daysSelect = document.getElementById('days');
        const leaveForm = document.getElementById('leaveForm');
        const singleDateField = document.querySelector('.single-date');
        const multipleDatesFields = document.querySelectorAll('.multiple-dates');

        function updateDateFields() {
            const days = daysSelect.value;
            if (days === '1') {
                singleDateField.style.display = 'block';
                singleDateField.querySelector('input').setAttribute('required', 'required');
                multipleDatesFields.forEach(field => {
                    field.style.display = 'none';
                    field.querySelector('input').removeAttribute('required');
                });
            } else {
                singleDateField.style.display = 'none';
                singleDateField.querySelector('input').removeAttribute('required');
                multipleDatesFields.forEach(field => {
                    field.style.display = 'block';
                    field.querySelector('input').setAttribute('required', 'required');
                });
            }
        }

        function validateForm(event) {
            const typeOfLeave = typeOfLeaveSelect.value;
            const days = parseInt(daysSelect.value, 10);
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            let dateDifference = 0;

            if (days > 1) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                dateDifference = Math.floor((end - start) / (1000 * 60 * 60 * 24)) + 1;
            } else {
                dateDifference = 1;
            }

            if (dateDifference !== days) {
                alert('The number of days requested does not match the date range provided.');
                event.preventDefault();
                return;
            }

            if (typeOfLeave === 'CasualLeave' && days > 2) {
                alert('Casual leave cannot exceed 2 consecutive days.');
                event.preventDefault();
                return;
            }

            if (typeOfLeave === 'CasualLeave' && dateDifference > 2) {
                alert('Casual leave cannot exceed 2 consecutive days.');
                event.preventDefault();
                return;
            }

            if (typeOfLeave === 'BereavementLeave' && days > 3) {
                alert('Bereavement leave cannot exceed 3 days.');
                event.preventDefault();
                return;
            }

            if (typeOfLeave === 'MarriageLeave' && days > 5) {
                alert('Marriage leave cannot exceed 5 days.');
                event.preventDefault();
                return;
            }

            if (typeOfLeave === 'MaternityLeave' && days > 24) {
                alert('Maternity leave cannot exceed 24 weeks.');
                event.preventDefault();
                return;
            }

            if (typeOfLeave === 'PaternityLeave' && days > 3) {
                alert('Paternity leave cannot exceed 3 days.');
                event.preventDefault();
                return;
            }

            if (typeOfLeave === 'AdoptionLeave' && days > 5) {
                alert('Adoption leave cannot exceed 5 days.');
                event.preventDefault();
                return;
            }

            if (typeOfLeave === 'EmergencyLeave' && days > 1) {
                alert('Emergency leave cannot exceed 1 day.');
                event.preventDefault();
                return;
            }
        }

        typeOfLeaveSelect.addEventListener('change', updateDateFields);
        daysSelect.addEventListener('change', updateDateFields);
        leaveForm.addEventListener('submit', validateForm);
        updateDateFields(); // Initial call to set the correct fields on page load
    });
</script>
<script
        src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script
        src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>
</body>
</html>

